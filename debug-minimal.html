<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GridFlow Debug - Minimal</title>
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>GridFlow Debug - Minimal Loading</h1>
    <div id="status"></div>
    <button onclick="testStep1()">1. Test Dexie Basic</button>
    <button onclick="testStep2()">2. Test DB Creation</button>
    <button onclick="testStep3()">3. Test Core Data</button>
    <button onclick="testStep4()">4. Test Full App</button>
    <button onclick="clearAndRestart()">Clear All & Restart</button>

    <script>
        const status = document.getElementById('status');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            status.appendChild(div);
            console.log(message);
        }

        function clearAndRestart() {
            localStorage.clear();
            sessionStorage.clear();
            indexedDB.deleteDatabase('GridFlowDB');
            status.innerHTML = '';
            log('Cleared all data', 'info');
        }

        async function testStep1() {
            try {
                log('Testing Dexie basic functionality...', 'info');
                
                // Test basic Dexie
                if (!window.Dexie) {
                    throw new Error('Dexie not loaded');
                }
                
                const testDB = new Dexie('TestDB');
                testDB.version(1).stores({ test: 'id' });
                await testDB.open();
                await testDB.test.add({ id: 1, data: 'test' });
                const result = await testDB.test.get(1);
                await testDB.delete();
                
                if (result && result.data === 'test') {
                    log('✅ Dexie working correctly', 'success');
                } else {
                    throw new Error('Dexie test failed');
                }
            } catch (error) {
                log(`❌ Step 1 failed: ${error.message}`, 'error');
            }
        }

        async function testStep2() {
            try {
                log('Testing GridFlow DB creation...', 'info');
                
                // Test GridFlow DB structure
                class TestGridFlowDB extends Dexie {
                    constructor() {
                        super('GridFlowDB');
                        this.version(1).stores({
                            entities: 'id, type, boardId, completed, priority, dueDate, *tags, *people, createdAt, updatedAt',
                            boards: 'id, name, createdAt',
                            metadata: 'key, lastUpdated'
                        });
                    }
                }
                
                const db = new TestGridFlowDB();
                await db.open();
                
                // Test basic operations
                await db.metadata.put({ key: 'test', value: 'working', lastUpdated: new Date().toISOString() });
                const test = await db.metadata.get('test');
                
                if (test && test.value === 'working') {
                    log('✅ GridFlow DB structure working', 'success');
                    window.testDB = db;
                } else {
                    throw new Error('DB test failed');
                }
            } catch (error) {
                log(`❌ Step 2 failed: ${error.message}`, 'error');
            }
        }

        async function testStep3() {
            try {
                log('Testing core data loading...', 'info');
                
                if (!window.testDB) {
                    throw new Error('Run step 2 first');
                }
                
                // Create minimal sample data
                await window.testDB.boards.put({
                    id: 'default',
                    name: 'Test Board',
                    groups: [],
                    rows: [{
                        id: 1,
                        name: 'Test Row',
                        cards: { todo: [], done: [] }
                    }],
                    columns: [
                        { id: 1, name: 'To Do', key: 'todo' },
                        { id: 2, name: 'Done', key: 'done' }
                    ],
                    settings: { showCheckboxes: true },
                    createdAt: new Date().toISOString()
                });
                
                await window.testDB.metadata.put({
                    key: 'currentBoardId',
                    value: 'default',
                    lastUpdated: new Date().toISOString()
                });
                
                // Test loading
                const board = await window.testDB.boards.get('default');
                const currentBoardId = await window.testDB.metadata.get('currentBoardId');
                
                if (board && currentBoardId) {
                    log('✅ Core data operations working', 'success');
                    log(`Board: ${board.name}, Current: ${currentBoardId.value}`);
                } else {
                    throw new Error('Data loading failed');
                }
            } catch (error) {
                log(`❌ Step 3 failed: ${error.message}`, 'error');
            }
        }

        async function testStep4() {
            try {
                log('Testing full app loading...', 'info');
                
                // Try to load the full app
                window.location.href = '/';
            } catch (error) {
                log(`❌ Step 4 failed: ${error.message}`, 'error');
            }
        }

        // Auto-run basic test
        log('Debug page loaded. Click buttons to test step by step.', 'info');
    </script>
</body>
</html>